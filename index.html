<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MetrologyPro AI - Enterprise Vision</title>
    
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400&display=swap" rel="stylesheet">

    <style>
        :root { --bg-dark: #09090b; --bg-sidebar: #0f0f11; --accent: #3b82f6; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-dark); color: #e4e4e7; overflow: hidden; height: 100dvh; width: 100vw; }
        .safe-top { padding-top: env(safe-area-inset-top); }
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        .scroller::-webkit-scrollbar { width: 4px; }
        .scroller::-webkit-scrollbar-track { background: transparent; }
        .scroller::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 10px; }
        .glass { background: rgba(24, 24, 27, 0.8); backdrop-filter: blur(12px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .glass-popover { background: rgba(30, 30, 35, 0.95); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .msg-enter { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes pulse-dot { 0%, 100% { opacity: 0.4; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.1); } }
        .typing-dot { animation: pulse-dot 1.2s infinite ease-in-out; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; } .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        /* --- TYPOGRAPHY / LAYOUT FIXES --- */
        .prose { font-size: 0.935rem; max-width: none; }
        .prose p { margin-bottom: 1.25em; line-height: 1.75; color: #d4d4d8; letter-spacing: 0.01em; }
        .prose p:last-child { margin-bottom: 0; }
        .prose h1, .prose h2, .prose h3 { color: #f4f4f5; font-weight: 700; margin-top: 1.75em; margin-bottom: 0.75em; line-height: 1.3; }
        .prose h1 { font-size: 1.5em; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 0.3em; }
        .prose h2 { font-size: 1.25em; }
        .prose h3 { font-size: 1.1em; color: #e4e4e7; }
        .prose ul { list-style-type: disc; padding-left: 1.5em; margin-bottom: 1.25em; color: #d4d4d8; }
        .prose ol { list-style-type: decimal; padding-left: 1.5em; margin-bottom: 1.25em; color: #d4d4d8; }
        .prose li { margin-bottom: 0.5em; padding-left: 0.25em; }
        .prose li::marker { color: #60a5fa; } 
        .prose strong { color: #fff; font-weight: 600; }
        .prose a { color: #60a5fa; text-decoration: none; border-bottom: 1px solid rgba(96, 165, 250, 0.3); transition: all 0.2s; }
        .prose a:hover { border-bottom-color: #60a5fa; color: #93c5fd; }
        .prose blockquote { border-left: 4px solid #3b82f6; padding: 0.75rem 1rem; margin: 1.5rem 0; background: rgba(59, 130, 246, 0.05); border-radius: 0 0.5rem 0.5rem 0; color: #a1a1aa; font-style: italic; }
        .prose table { width: 100%; text-align: left; border-collapse: collapse; margin-bottom: 1.5rem; font-size: 0.9em; }
        .prose th { border-bottom: 1px solid #3f3f46; padding: 0.75rem; color: #fff; font-weight: 600; background: rgba(255,255,255,0.03); }
        .prose td { border-bottom: 1px solid #27272a; padding: 0.75rem; color: #d4d4d8; }
        .prose pre { background: #000; padding: 1rem; border-radius: 0.5rem; border: 1px solid #27272a; overflow-x: auto; margin-bottom: 1.5rem; }
        .prose code { font-family: 'JetBrains Mono', monospace; font-size: 0.85em; color: #f472b6; background: rgba(255,255,255,0.05); padding: 0.2em 0.4em; border-radius: 0.25em; }
        .prose pre code { background: transparent; padding: 0; color: inherit; }
        .user-content .prose p { color: #fff; margin-bottom: 0.5em; }
        .user-content .prose a { color: #fff; border-bottom-color: rgba(255,255,255,0.5); }
    </style>
    
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body>
    <div id="root" class="h-full w-full"></div>

    <!-- FIREBASE MODULE SETUP -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    

        window.authService = { isConfigured: false, auth: null, login: async () => console.error("Firebase not configured"), logout: async () => {}, init: (cb) => cb(null) };

        if (firebaseConfig.apiKey !== "AIzaSyD7nQn-RBaFFBUIszq5bj0nODicirwVoh4") {
            try {
                const app = initializeApp(firebaseConfig);
                const auth = getAuth(app);
                const provider = new GoogleAuthProvider();
                window.authService = {
                    isConfigured: true,
                    auth: auth,
                    login: async () => { const res = await signInWithPopup(auth, provider); return res.user; },
                    logout: async () => await signOut(auth),
                    init: (cb) => onAuthStateChanged(auth, cb)
                };
            } catch (e) { console.error("Firebase Init Error:", e); }
        }
    </script>

    <!-- REACT APP -->
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        
        // --- API KEY UPDATE ---
        const API_KEY = "AIzaSyBjbIiqrrdgZ9nZ-qWmwGBeEOSxIIqaTIs"; 
        const MODEL = "gemini-2.5-flash-preview-09-2025";
        
        const generateId = () => Math.random().toString(36).substr(2, 9);
        const getTime = () => new Date().toLocaleTimeString('id-ID', {hour: '2-digit', minute:'2-digit'});

        const extractTextFromPDF = async (file) => {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
                let fullText = "";
                const maxPages = Math.min(pdf.numPages, 10);
                for (let i = 1; i <= maxPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(" ");
                    fullText += `[Halaman ${i}]: ${pageText}\n`;
                }
                return fullText;
            } catch (error) { console.error("PDF Error:", error); return "Gagal membaca teks PDF."; }
        };

        const fileToBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result.split(',')[1]);
            reader.onerror = error => reject(error);
        });

        const SidebarItem = ({ session, active, onClick, onDelete }) => (
            <div onClick={onClick} className={`group flex items-center gap-3 px-3 py-3 rounded-xl cursor-pointer transition-all border ${active ? 'bg-white/10 border-white/10 text-white' : 'border-transparent text-gray-400 hover:bg-white/5 hover:text-gray-200'}`}>
                <i className={`fa-regular fa-message text-xs ${active ? 'text-blue-400' : 'opacity-50'}`}></i>
                <div className="flex-1 overflow-hidden">
                    <p className="text-sm font-medium truncate">{session.title}</p>
                    <p className="text-[10px] opacity-50 truncate">{session.timestamp.toLocaleDateString()}</p>
                </div>
                <button onClick={(e) => { e.stopPropagation(); onDelete(); }} className="w-6 h-6 rounded flex items-center justify-center opacity-0 group-hover:opacity-100 hover:bg-red-500/20 hover:text-red-400 transition-all"><i className="fa-solid fa-xmark text-xs"></i></button>
            </div>
        );

        const App = () => {
            const [user, setUser] = useState(null);
            const [authLoading, setAuthLoading] = useState(true);
            const [sessions, setSessions] = useState([{ id: 'init', title: 'Chat Baru', timestamp: new Date(), messages: [{ id: 'w1', role: 'ai', text: "Halo. Saya **MetrologyPro AI**.\n\nSaya siap membantu analisis teknis dan regulasi.", timestamp: getTime() }] }]);
            const [activeId, setActiveId] = useState('init');
            const [input, setInput] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const [sidebarOpen, setSidebarOpen] = useState(false);
            const [menuOpen, setMenuOpen] = useState(false);
            const [attachments, setAttachments] = useState([]);

            const bottomRef = useRef(null);
            const fileRef = useRef(null);
            const pdfRef = useRef(null);

            const activeSession = sessions.find(s => s.id === activeId) || sessions[0];
            const messages = activeSession.messages;

            useEffect(() => {
                if (window.authService && window.authService.init) {
                    window.authService.init((u) => { setUser(u); setAuthLoading(false); });
                } else { setAuthLoading(false); }
            }, []);
            useEffect(() => { bottomRef.current?.scrollIntoView({ behavior: "smooth" }); }, [messages, isLoading]);

            const handleLogin = async () => { if (!window.authService.isConfigured) { alert("Konfigurasi Firebase belum diisi."); return; } try { await window.authService.login(); } catch (err) { alert("Login Error"); } };
            const handleLogout = async () => { await window.authService.logout(); setUser(null); };
            const createSession = () => {
                const newId = generateId();
                setSessions([{ id: newId, title: 'Chat Baru', timestamp: new Date(), messages: [] }, ...sessions]);
                setActiveId(newId); setSidebarOpen(false);
            };
            const deleteSession = (id) => {
                const remain = sessions.filter(s => s.id !== id);
                if(remain.length === 0) { setSessions([{ id: 'init', title: 'Chat Baru', timestamp: new Date(), messages: []}]); setActiveId('init'); } else { setSessions(remain); if(activeId === id) setActiveId(remain[0].id); }
            };

            const handleFile = (e, type) => {
                const f = e.target.files[0];
                if(f) {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        setAttachments([...attachments, { name: f.name, type, preview: type === 'image' ? ev.target.result : null, file: f }]);
                        setMenuOpen(false);
                    };
                    reader.readAsDataURL(f);
                }
                e.target.value = null;
            };

            const handleSend = async (e) => {
                e.preventDefault();
                if ((!input.trim() && attachments.length === 0) || isLoading) return;

                const txt = input;
                const atts = [...attachments]; 
                
                setSessions(prev => prev.map(s => {
                    if (s.id === activeId) {
                        let newTitle = s.title;
                        const userMsgCount = s.messages.filter(m => m.role === 'user').length;
                        if (userMsgCount === 0) newTitle = txt ? (txt.slice(0, 25) + (txt.length>25?'...':'')) : (atts.length > 0 ? `File: ${atts[0].name}` : 'Chat Baru');
                        return { ...s, title: newTitle, messages: [...s.messages, { id: generateId(), role: 'user', text: txt, attachments: atts, timestamp: getTime() }] };
                    }
                    return s;
                }));

                setInput(""); setAttachments([]); setIsLoading(true);

                let apiParts = [];
                let contextText = txt;
                const historyParts = messages.slice(-5).map(m => ({ role: m.role==='ai'?'model':'user', parts: [{ text: m.text }] }));

                try {
                    if (atts.length > 0) {
                        contextText += `\n\n[Daftar Lampiran User:]\n`;
                        for (const att of atts) {
                            if (att.type === 'image') {
                                const base64Data = await fileToBase64(att.file);
                                apiParts.push({ inlineData: { mimeType: att.file.type, data: base64Data } });
                                contextText += `- Gambar: ${att.name} (Data visual dikirim)\n`;
                            } else if (att.type === 'pdf') {
                                const pdfText = await extractTextFromPDF(att.file);
                                contextText += `- Dokumen PDF (${att.name}) ISI TEKS:\n${pdfText}\n---\n`;
                            }
                        }
                    }
                    apiParts.push({ text: contextText });

                    const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ contents: [...historyParts, { role: 'user', parts: apiParts }], tools: [{ google_search: {} }] })
                    });

                    const data = await res.json();
                    const text = data.candidates?.[0]?.content?.parts?.[0]?.text || "Maaf, respon tidak tersedia.";
                    const sources = data.candidates?.[0]?.groundingMetadata?.groundingChunks?.filter(c => c.web?.uri).map(c => ({ title: c.web?.title, uri: c.web?.uri })) || [];
                    const uniqueSources = [...new Map(sources.map(item => [item['uri'], item])).values()];

                    setSessions(prev => prev.map(s => {
                        if (s.id === activeId) return { ...s, messages: [...s.messages, { id: generateId(), role: 'ai', text, sources: uniqueSources, timestamp: getTime() }] };
                        return s;
                    }));

                } catch (err) {
                    setSessions(prev => prev.map(s => s.id === activeId ? {...s, messages: [...s.messages, { id: generateId(), role: 'ai', text: `Error: ${err.message}`, isError: true }]} : s));
                } finally { setIsLoading(false); }
            };

            const renderMarkdown = (txt) => ({ __html: marked.parse(txt) });

            return (
                <div className="flex h-full w-full relative">
                    <div className={`fixed inset-y-0 left-0 z-[60] w-72 bg-[var(--bg-sidebar)] border-r border-white/5 flex flex-col transition-transform duration-300 transform md:relative md:translate-x-0 ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}`}>
                        <div className="h-16 flex items-center px-5 border-b border-white/5 safe-top">
                            <div className="flex items-center gap-3">
                                <div className="w-8 h-8 rounded bg-gradient-to-br from-blue-600 to-indigo-600 flex items-center justify-center shadow-lg shadow-blue-500/20"><i className="fa-solid fa-cube text-white text-xs"></i></div>
                                <div><h1 className="font-bold text-sm text-white tracking-wide leading-none">MetrologyPro</h1><span className="text-[10px] text-gray-500 font-mono">Enterprise</span></div>
                            </div>
                            <button onClick={() => setSidebarOpen(false)} className="md:hidden ml-auto text-gray-500 p-2"><i className="fa-solid fa-xmark"></i></button>
                        </div>
                        <div className="p-4"><button onClick={createSession} className="w-full flex items-center justify-center gap-2 bg-[#1c1c1f] hover:bg-[#27272a] border border-white/5 text-white py-2.5 rounded-xl text-sm font-medium transition-all"><i className="fa-solid fa-plus text-blue-500"></i><span>Chat Baru</span></button></div>
                        <div className="flex-1 overflow-y-auto px-2 space-y-1 scroller py-2"><p className="px-3 text-[10px] font-bold text-gray-600 uppercase tracking-widest mb-2">Riwayat</p>{sessions.map(s => <SidebarItem key={s.id} session={s} active={activeId === s.id} onClick={() => {setActiveId(s.id); setSidebarOpen(false);}} onDelete={() => deleteSession(s.id)} />)}</div>
                        <div className="p-4 border-t border-white/5 bg-black/20 safe-bottom">
                            {authLoading ? <div className="text-center text-xs text-gray-500"><i className="fa-solid fa-circle-notch fa-spin mr-2"></i>Loading Auth...</div> : user ? 
                            <div className="flex items-center justify-between"><div className="flex items-center gap-3 overflow-hidden">{user.photoURL ? <img src={user.photoURL} className="w-9 h-9 rounded-full border border-white/10" /> : <div className="w-9 h-9 rounded-full bg-blue-600 flex items-center justify-center">{user.displayName?.[0]}</div>}<div className="flex-1 min-w-0"><p className="text-xs font-bold text-white truncate">{user.displayName}</p><p className="text-[10px] text-gray-500 truncate">{user.email}</p></div></div><button onClick={handleLogout} className="text-gray-500 hover:text-red-400 p-2"><i className="fa-solid fa-right-from-bracket"></i></button></div> : 
                            <button onClick={handleLogin} className="w-full flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-500 text-white py-2 rounded-lg text-xs font-bold transition-all shadow-lg shadow-blue-900/20"><i className="fa-brands fa-google"></i> Login Google</button>}
                        </div>
                    </div>
                    {sidebarOpen && <div onClick={() => setSidebarOpen(false)} className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 md:hidden"></div>}

                    <div className="flex-1 flex flex-col h-full bg-[#09090b] relative w-full">
                        <div className="md:hidden flex items-center justify-between px-4 h-16 border-b border-white/5 bg-[#09090b]/90 backdrop-blur z-40 sticky top-0 safe-top">
                            <div className="flex items-center gap-2"><i className="fa-solid fa-shield-halved text-blue-500"></i><span className="font-bold text-white text-sm">MetrologyPro</span></div>
                            <button onClick={() => setSidebarOpen(true)} className="text-gray-300 p-2"><i className="fa-solid fa-bars text-lg"></i></button>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 md:p-6 space-y-8 scroller">
                            {messages.length === 0 && <div className="flex flex-col items-center justify-center h-full text-gray-500 opacity-30 select-none"><i className="fa-solid fa-scale-balanced text-5xl mb-4"></i><p className="text-sm font-medium">MetrologyPro Enterprise</p></div>}
                            {messages.map((msg) => (
                                <div key={msg.id} className={`msg-enter flex gap-4 max-w-4xl mx-auto ${msg.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    {msg.role === 'ai' && <div className="w-9 h-9 rounded-xl bg-[#1c1c1f] border border-white/10 flex items-center justify-center flex-shrink-0 mt-1"><i className="fa-solid fa-robot text-blue-400 text-sm"></i></div>}
                                    <div className={`flex flex-col gap-2 max-w-[85%] md:max-w-[75%] ${msg.role === 'user' ? 'items-end' : 'items-start'}`}>
                                        <div className="flex items-center gap-2 px-1"><span className="text-[10px] text-gray-500 font-mono opacity-70 uppercase tracking-wider">{msg.role === 'user' ? 'Anda' : 'Assistant'} â€¢ {msg.timestamp}</span></div>
                                        {msg.attachments && msg.attachments.length > 0 && <div className="flex flex-wrap gap-2 justify-end">{msg.attachments.map((att, i) => (<div key={i} className="bg-[#1c1c1f] border border-white/10 rounded-lg p-2 flex items-center gap-3 pr-4 max-w-full">{att.type === 'image' && att.preview ? <img src={att.preview} className="h-10 w-10 rounded object-cover" /> : <div className={`h-10 w-10 flex items-center justify-center rounded-md ${att.type==='pdf' ? 'bg-red-500/10 text-red-400' : 'bg-white/10 text-gray-400'}`}><i className={`fa-solid ${att.type==='pdf' ? 'fa-file-pdf text-xl' : 'fa-file text-xl'}`}></i></div>}<span className="text-xs text-gray-300 truncate max-w-[150px] font-medium">{att.name}</span></div>))}</div>}
                                        <div className={`p-5 rounded-2xl text-[0.935rem] shadow-sm border ${msg.role === 'user' ? 'bg-blue-600 text-white rounded-tr-none border-blue-500 text-left user-content' : 'bg-[#18181b] text-gray-200 rounded-tl-none border-white/5'}`}>
                                            <div className="prose prose-invert" dangerouslySetInnerHTML={renderMarkdown(msg.text)}></div>
                                            {msg.sources && msg.sources.length > 0 && <div className="mt-4 pt-4 border-t border-white/10"><p className="text-[10px] font-bold text-gray-500 uppercase mb-2">Sumber Referensi:</p><div className="flex flex-wrap gap-2">{msg.sources.map((src, i) => (<a key={i} href={src.uri} target="_blank" className="flex items-center gap-1.5 px-2.5 py-1.5 bg-black/20 hover:bg-black/40 rounded-md border border-white/10 text-[11px] text-blue-300 transition-colors no-underline"><i className="fa-solid fa-link text-[9px]"></i> {src.title}</a>))}</div></div>}
                                        </div>
                                    </div>
                                </div>
                            ))}
                            {isLoading && <div className="flex gap-4 max-w-4xl mx-auto"><div className="w-9 h-9 rounded-xl bg-transparent flex items-center justify-center mt-1"><i className="fa-solid fa-robot text-gray-600 text-sm"></i></div><div className="px-5 py-4 bg-[#18181b] border border-white/5 rounded-2xl rounded-tl-none flex gap-1.5 items-center"><div className="w-1.5 h-1.5 bg-blue-500 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-blue-500 rounded-full typing-dot"></div><div className="w-1.5 h-1.5 bg-blue-500 rounded-full typing-dot"></div></div></div>}
                            <div ref={bottomRef} className="h-4"></div>
                        </div>

                        <div className="p-3 md:p-5 z-30 bg-gradient-to-t from-[#09090b] to-transparent safe-bottom">
                            <div className="max-w-4xl mx-auto relative glass-popover rounded-2xl p-2 transition-all shadow-2xl">
                                {menuOpen && <div className="absolute bottom-full left-0 mb-2 bg-[#1c1c1f] border border-white/10 rounded-xl shadow-2xl overflow-hidden min-w-[220px] z-50 flex flex-col msg-enter">
                                    <button onClick={() => { if(!user) alert("Login Google diperlukan."); else alert("Mode Simulasi Drive Lokal."); setMenuOpen(false); }} className="flex items-center gap-3 px-4 py-3.5 hover:bg-white/5 border-b border-white/5 text-left"><i className="fa-brands fa-google-drive text-green-400 w-5 text-center text-lg"></i><div><div className="text-sm text-white font-medium">Google Drive</div><div className="text-[10px] text-gray-500">Pilih dari Cloud</div></div></button>
                                    <button onClick={() => pdfRef.current.click()} className="flex items-center gap-3 px-4 py-3.5 hover:bg-white/5 border-b border-white/5 text-left"><i className="fa-solid fa-file-pdf text-red-400 w-5 text-center text-lg"></i><div><div className="text-sm text-white font-medium">Upload PDF</div><div className="text-[10px] text-gray-500">Analisis Dokumen</div></div></button>
                                    <button onClick={() => fileRef.current.click()} className="flex items-center gap-3 px-4 py-3.5 hover:bg-white/5 text-left"><i className="fa-solid fa-image text-blue-400 w-5 text-center text-lg"></i><div><div className="text-sm text-white font-medium">Upload Gambar</div><div className="text-[10px] text-gray-500">Visi Komputer</div></div></button>
                                </div>}
                                <input type="file" ref={fileRef} onChange={(e) => handleFile(e, 'image')} className="hidden" accept="image/*" />
                                <input type="file" ref={pdfRef} onChange={(e) => handleFile(e, 'pdf')} className="hidden" accept=".pdf" />
                                {attachments.length > 0 && <div className="flex gap-2 p-2 border-b border-white/5 overflow-x-auto">{attachments.map((att, i) => (<div key={i} className="relative bg-black/40 rounded-lg p-1.5 border border-white/10 group">{att.type==='image' && att.preview ? <img src={att.preview} className="h-12 w-12 rounded-md object-cover" /> : <div className={`h-12 w-12 flex items-center justify-center rounded-md ${att.type==='pdf' ? 'bg-red-500/10 text-red-400' : 'bg-white/10 text-gray-400'}`}><i className={`fa-solid ${att.type==='pdf' ? 'fa-file-pdf text-xl' : 'fa-file text-xl'}`}></i></div>}<button onClick={() => setAttachments(attachments.filter((_, idx) => idx!==i))} className="absolute -top-1.5 -right-1.5 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px] shadow-sm"><i className="fa-solid fa-xmark"></i></button></div>))}</div>}
                                <form onSubmit={handleSend} className="flex items-end gap-2">
                                    <button type="button" onClick={() => setMenuOpen(!menuOpen)} className={`p-3 rounded-xl transition-all ${menuOpen ? 'bg-white/10 text-white rotate-45' : 'text-gray-400 hover:text-white hover:bg-white/5'}`}><i className="fa-solid fa-plus text-lg"></i></button>
                                    <textarea value={input} onChange={(e) => setInput(e.target.value)} onKeyDown={(e) => { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(e); }}} placeholder="Apa yang ingin Anda tanyakan mengenai Direktorat Metrologi?" className="w-full bg-transparent border-none text-gray-200 placeholder-gray-500 focus:ring-0 resize-none max-h-32 min-h-[44px] py-3 pl-4 text-sm leading-normal" rows="1" style={{height:'auto'}}></textarea>
                                    <button type="submit" disabled={!input.trim() && attachments.length === 0 || isLoading} className="p-3 bg-blue-600 hover:bg-blue-500 disabled:bg-white/5 disabled:text-gray-600 text-white rounded-xl transition-all shadow-lg"><i className="fa-solid fa-paper-plane text-sm"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>



